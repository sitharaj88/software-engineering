import{j as t}from"./jsx-runtime.ClP7wGfN.js";import{r as m}from"./index.DK-fsZOb.js";import{A as U}from"./index.CMzh-1wI.js";import{m as M}from"./proxy.i6brGrIQ.js";const v=["#0066cc","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"],j=16,Y=100,T=60,V=60,G=50;function ce(u=640){const[o,d]=m.useState(!1);return m.useEffect(()=>{const h=window.matchMedia(`(max-width: ${u}px)`);d(h.matches);const x=w=>d(w.matches);return h.addEventListener("change",x),()=>h.removeEventListener("change",x)},[u]),o}const le=()=>Math.random().toString(16).substring(2,9),l=(u,o,d,h)=>({id:u,hash:le(),message:o,parents:d,branch:h,x:0,y:0});function N(){return{commits:[l("c0","Initial commit",[],"main")],branches:[{name:"main",color:v[0],headCommitId:"c0"}],currentBranch:"main",nextCommitNum:1}}function R(u,o){return u.find(d=>d.name===o)?.color??v[0]}function me(u,o){const d={};return o.forEach((h,x)=>{d[h.name]=x}),u.map((h,x)=>({...h,x:V+x*Y,y:G+(d[h.branch]??0)*T}))}const E={border:"1.5px solid var(--sl-color-gray-5)",borderRadius:10,marginBottom:"1rem",background:"var(--sl-color-gray-6)",padding:"1rem",boxShadow:"0 1px 4px rgba(0,0,0,0.06)"},z={fontSize:"0.7rem",fontWeight:700,color:"var(--sl-color-gray-3)",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem"},X={padding:"0.5rem 0.75rem",borderRadius:6,border:"1.5px solid var(--sl-color-gray-4)",background:"var(--sl-color-bg)",color:"var(--sl-color-text)",fontSize:"0.85rem",fontWeight:500,outline:"none",width:"100%",boxSizing:"border-box"},q={borderRadius:6,fontWeight:600,fontSize:"0.82rem",cursor:"pointer",whiteSpace:"nowrap",transition:"opacity 0.15s",padding:"0.5rem 1rem",minHeight:38},L=u=>({...q,background:u,color:"#fff",border:"none"}),D={...q,background:"var(--sl-color-gray-5)",color:"var(--sl-color-text)",border:"1px solid var(--sl-color-gray-4)",fontSize:"0.75rem",padding:"0.35rem 0.75rem"};function ge(){const u=ce(),[o,d]=m.useState(N),[h,x]=m.useState(""),[w,W]=m.useState([]),[Q,P]=m.useState(""),A=m.useRef(null),_=m.useRef(null),I=me(o.commits,o.branches),F=Math.max(400,V+o.commits.length*Y+80),O=Math.max(160,G+o.branches.length*T+40),J=o.branches.find(e=>e.name===o.currentBranch),p=I.find(e=>e.id===J?.headCommitId),i=m.useCallback((e,r,a)=>{W(n=>[...n,{command:e,result:r,success:a}])},[]),y=m.useCallback(e=>{const r=e.trim();r&&d(a=>{const n={...a,commits:[...a.commits],branches:a.branches.map(s=>({...s}))},S=r.match(/^git\s+commit\s+-m\s+["'](.+?)["']$/i);if(S){const s=n.branches.find(B=>B.name===n.currentBranch);if(!s)return i(r,`Error: branch '${n.currentBranch}' not found`,!1),a;const c=`c${n.nextCommitNum}`,g=l(c,S[1],[s.headCommitId],n.currentBranch);return n.commits.push(g),s.headCommitId=c,n.nextCommitNum++,i(r,`Created commit ${g.hash.slice(0,7)} on ${n.currentBranch}`,!0),n}const f=r.match(/^git\s+branch\s+(\S+)$/i);if(f){const s=f[1];if(n.branches.find(g=>g.name===s))return i(r,`Error: branch '${s}' already exists`,!1),a;const c=n.branches.find(g=>g.name===n.currentBranch);return c?(n.branches.push({name:s,color:v[n.branches.length%v.length],headCommitId:c.headCommitId}),i(r,`Created branch '${s}' at ${c.headCommitId}`,!0),n):(i(r,"Error: no current branch",!1),a)}const k=r.match(/^git\s+checkout\s+(\S+)$/i);if(k)return n.branches.find(c=>c.name===k[1])?(n.currentBranch=k[1],i(r,`Switched to branch '${k[1]}'`,!0),n):(i(r,`Error: branch '${k[1]}' not found`,!1),a);const b=r.match(/^git\s+merge\s+(\S+)$/i);if(b){const s=n.branches.find($=>$.name===b[1]),c=n.branches.find($=>$.name===n.currentBranch);if(!s)return i(r,`Error: branch '${b[1]}' not found`,!1),a;if(!c)return i(r,"Error: no current branch",!1),a;if(s.headCommitId===c.headCommitId)return i(r,"Already up to date",!0),a;const g=`c${n.nextCommitNum}`,B=l(g,`Merge branch '${b[1]}' into ${n.currentBranch}`,[c.headCommitId,s.headCommitId],n.currentBranch);return n.commits.push(B),c.headCommitId=g,n.nextCommitNum++,i(r,`Merged '${b[1]}' into '${n.currentBranch}' (${B.hash.slice(0,7)})`,!0),n}const C=r.match(/^git\s+rebase\s+(\S+)$/i);if(C){const s=n.branches.find($=>$.name===C[1]),c=n.branches.find($=>$.name===n.currentBranch);if(!s)return i(r,`Error: branch '${C[1]}' not found`,!1),a;if(!c)return i(r,"Error: no current branch",!1),a;if(s.headCommitId===c.headCommitId)return i(r,"Already up to date",!0),a;const g=`c${n.nextCommitNum}`,B=l(g,`Rebased ${n.currentBranch} onto ${C[1]}`,[s.headCommitId],n.currentBranch);return n.commits.push(B),c.headCommitId=g,n.nextCommitNum++,i(r,`Rebased '${n.currentBranch}' onto '${C[1]}'`,!0),n}return i(r,`Unknown command: ${r}`,!1),a})},[i]),K=m.useCallback(e=>{e.preventDefault(),y(h),x(""),_.current?.focus()},[h,y]),Z=m.useCallback(()=>{const e=["Add feature","Fix bug","Update docs","Refactor code","Add tests","Optimize perf"];y(`git commit -m "${e[Math.floor(Math.random()*e.length)]}"`)},[y]),ee=m.useCallback(()=>{const e=["feature","bugfix","hotfix","release","develop","experiment"],r=new Set(o.branches.map(n=>n.name)),a=e.find(n=>!r.has(n))??`branch-${Date.now().toString(36).slice(-4)}`;y(`git branch ${a}`)},[y,o.branches]),te=m.useCallback(()=>{const e=o.branches.find(r=>r.name!==o.currentBranch);e&&y(`git merge ${e.name}`)},[y,o.branches,o.currentBranch]),re=m.useCallback(e=>{e&&(y(`git checkout ${e}`),P(""))},[y]),H=m.useCallback(e=>{W([]);const r=N();if(e==="feature"){r.commits.push(l("c1","Add README",["c0"],"main"),l("c2","Setup project",["c1"],"main"),l("c3","Add login UI",["c2"],"feature"),l("c4","Add auth logic",["c3"],"feature")),r.branches[0].headCommitId="c2",r.branches.push({name:"feature",color:v[1],headCommitId:"c4"}),r.nextCommitNum=5,d(r),i("scenario",'Loaded "Feature Branch" scenario',!0);return}if(e==="merge"){r.commits.push(l("c1","Add README",["c0"],"main"),l("c2","Add feature",["c1"],"feature"),l("c3","Fix main bug",["c1"],"main"),l("c4","Merge 'feature' into main",["c3","c2"],"main")),r.branches[0].headCommitId="c4",r.branches.push({name:"feature",color:v[1],headCommitId:"c2"}),r.nextCommitNum=5,d(r),i("scenario",'Loaded "Merge Example" scenario',!0);return}if(e==="multiple"){r.commits.push(l("c1","Setup",["c0"],"main"),l("c2","Feature A start",["c1"],"feature-a"),l("c3","Feature B start",["c1"],"feature-b"),l("c4","Main update",["c1"],"main"),l("c5","Feature A done",["c2"],"feature-a"),l("c6","Feature B done",["c3"],"feature-b")),r.branches[0].headCommitId="c4",r.branches.push({name:"feature-a",color:v[1],headCommitId:"c5"},{name:"feature-b",color:v[2],headCommitId:"c6"}),r.nextCommitNum=7,d(r),i("scenario",'Loaded "Multiple Branches" scenario',!0);return}},[i]),ne=m.useCallback(()=>{d(N()),W([]),x(""),P("")},[]);m.useEffect(()=>{A.current&&(A.current.scrollLeft=A.current.scrollWidth)},[o.commits.length]);const ae=()=>{const e=new Map(I.map(a=>[a.id,a])),r=[];return I.forEach(a=>{a.parents.forEach((n,S)=>{const f=e.get(n);if(!f)return;const b=S>0?R(o.branches,f.branch):R(o.branches,a.branch),C=`${n}-${a.id}-${S}`;if(f.y===a.y)r.push(t.jsx(M.line,{x1:f.x,y1:f.y,x2:a.x,y2:a.y,stroke:b,strokeWidth:2.5,strokeLinecap:"round",initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:.4}},C));else{const s=(f.x+a.x)/2,c=`M ${f.x} ${f.y} C ${s} ${f.y}, ${s} ${a.y}, ${a.x} ${a.y}`;r.push(t.jsx(M.path,{d:c,stroke:b,strokeWidth:2.5,fill:"none",strokeLinecap:"round",initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:.4}},C))}})}),r},oe=()=>I.map(e=>{const r=R(o.branches,e.branch),a=e.id===p?.id;return t.jsxs(M.g,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:300,damping:20},children:[t.jsx("circle",{cx:e.x,cy:e.y,r:j,fill:r,stroke:a?"#fff":"none",strokeWidth:a?3:0,style:{filter:a?`drop-shadow(0 0 6px ${r})`:"none"}}),e.parents.length>1&&t.jsx("circle",{cx:e.x,cy:e.y,r:j+4,fill:"none",stroke:r,strokeWidth:1.5,strokeDasharray:"4 3",opacity:.6}),t.jsx("text",{x:e.x,y:e.y+j+14,textAnchor:"middle",fontSize:9,fontFamily:"monospace",fill:"var(--sl-color-gray-3)",children:e.hash.slice(0,7)}),t.jsx("title",{children:`${e.hash.slice(0,7)} â€” ${e.message}`})]},e.id)}),se=()=>o.branches.map(e=>{const r=I.find(S=>S.id===e.headCommitId);if(!r)return null;const a=e.name===o.currentBranch,n=Math.max(56,e.name.length*7.5+16);return t.jsxs(M.g,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[t.jsx("rect",{x:r.x-28,y:r.y-j-24,width:n,height:18,rx:9,fill:e.color,opacity:a?1:.7}),t.jsx("text",{x:r.x-28+n/2,y:r.y-j-12,textAnchor:"middle",fontSize:10,fontWeight:a?700:500,fill:"#fff",fontFamily:"system-ui, sans-serif",children:e.name})]},e.name)}),ie=()=>p?t.jsxs(M.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[t.jsx("text",{x:p.x,y:p.y-j-30,textAnchor:"middle",fontSize:10,fontWeight:700,fill:"var(--sl-color-text)",fontFamily:"monospace",children:"HEAD"}),t.jsx("line",{x1:p.x,y1:p.y-j-27,x2:p.x,y2:p.y-j-22,stroke:"var(--sl-color-gray-3)",strokeWidth:1.5})]},"head-indicator"):null;return t.jsxs("div",{style:{border:"1px solid var(--sl-color-gray-5)",borderRadius:12,padding:u?"1rem":"1.25rem",background:"var(--sl-color-bg)",fontFamily:"system-ui, -apple-system, sans-serif"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem",flexWrap:"wrap",gap:"0.5rem"},children:[t.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--sl-color-text)"},children:"Git Graph Visualizer"}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[t.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--sl-color-gray-3)",fontFamily:"monospace"},children:["on ",t.jsx("strong",{style:{color:R(o.branches,o.currentBranch)},children:o.currentBranch})]}),t.jsx("button",{onClick:ne,style:{...q,background:"var(--sl-color-gray-5)",color:"var(--sl-color-text)",border:"1px solid var(--sl-color-gray-4)",fontSize:"0.72rem",padding:"0.25rem 0.6rem",minHeight:28},children:"Reset"})]})]}),t.jsxs("div",{style:E,children:[t.jsx("div",{style:z,children:"Scenarios"}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>H("feature"),style:D,children:"Feature Branch"}),t.jsx("button",{onClick:()=>H("merge"),style:D,children:"Merge Example"}),t.jsx("button",{onClick:()=>H("multiple"),style:D,children:"Multiple Branches"})]})]}),t.jsxs("div",{style:E,children:[t.jsx("div",{style:z,children:"Command"}),t.jsxs("form",{onSubmit:K,style:{display:"flex",gap:"0.5rem",flexDirection:u?"column":"row"},children:[t.jsx("input",{ref:_,value:h,onChange:e=>x(e.target.value),placeholder:'git commit -m "message"',style:{...X,flex:1,fontFamily:"monospace",fontSize:"0.82rem"}}),t.jsx("button",{type:"submit",style:L("#0066cc"),children:"Run"})]}),t.jsxs("div",{style:{marginTop:"0.6rem",fontSize:"0.7rem",color:"var(--sl-color-gray-3)",lineHeight:1.6},children:["Supported: ",t.jsx("code",{style:{fontSize:"0.68rem"},children:'git commit -m "msg"'})," | ",t.jsx("code",{style:{fontSize:"0.68rem"},children:"git branch name"})," | ",t.jsx("code",{style:{fontSize:"0.68rem"},children:"git checkout name"})," | ",t.jsx("code",{style:{fontSize:"0.68rem"},children:"git merge name"})," | ",t.jsx("code",{style:{fontSize:"0.68rem"},children:"git rebase name"})]})]}),t.jsxs("div",{style:E,children:[t.jsx("div",{style:z,children:"Quick Actions"}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[t.jsx("button",{onClick:Z,style:L("#10b981"),children:"Commit"}),t.jsx("button",{onClick:ee,style:L("#8b5cf6"),children:"New Branch"}),t.jsx("button",{onClick:te,style:{...L("#f59e0b"),opacity:o.branches.length<2?.5:1,pointerEvents:o.branches.length<2?"none":"auto"},children:"Merge"}),t.jsxs("select",{value:Q,onChange:e=>{re(e.target.value),e.target.value=""},style:{...X,width:"auto",minWidth:120,cursor:"pointer"},children:[t.jsx("option",{value:"",children:"Switch Branch..."}),o.branches.filter(e=>e.name!==o.currentBranch).map(e=>t.jsx("option",{value:e.name,children:e.name},e.name))]})]})]}),t.jsxs("div",{style:E,children:[t.jsx("div",{style:z,children:"Commit Graph"}),t.jsx("div",{ref:A,style:{overflowX:"auto",overflowY:"hidden",borderRadius:8,background:"var(--sl-color-gray-7, var(--sl-color-gray-6))",border:"1px solid var(--sl-color-gray-5)",padding:"0.5rem"},children:t.jsxs("svg",{width:F,height:O,viewBox:`0 0 ${F} ${O}`,style:{display:"block",minWidth:F},children:[o.branches.map((e,r)=>t.jsx("text",{x:14,y:G+r*T+4,fontSize:9,fill:"var(--sl-color-gray-3)",fontFamily:"monospace",opacity:.5,children:e.name},`row-${e.name}`)),ae(),t.jsx(U,{children:oe()}),se(),ie()]})})]}),t.jsxs("div",{style:E,children:[t.jsx("div",{style:z,children:"History Log"}),t.jsx("div",{style:{maxHeight:180,overflowY:"auto",fontSize:"0.78rem",fontFamily:"monospace",lineHeight:1.8},children:t.jsx(U,{children:w.length===0?t.jsx("div",{style:{color:"var(--sl-color-gray-3)",fontStyle:"italic",fontSize:"0.75rem"},children:"No commands executed yet. Try typing a git command or use the quick actions above."}):[...w].reverse().map((e,r)=>t.jsxs(M.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},style:{padding:"0.2rem 0",borderBottom:"1px solid var(--sl-color-gray-6, var(--sl-color-gray-5))"},children:[t.jsx("span",{style:{color:e.success?"#10b981":"#ef4444",marginRight:"0.5rem"},children:e.success?"$":"!"}),t.jsx("span",{style:{color:"var(--sl-color-text)"},children:e.command}),t.jsx("span",{style:{color:"var(--sl-color-gray-3)",marginLeft:"0.75rem"},children:e.result})]},w.length-1-r))})})]}),t.jsx("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap",marginTop:"0.5rem"},children:o.branches.map(e=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.35rem"},children:[t.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:e.color,border:e.name===o.currentBranch?"2px solid var(--sl-color-text)":"none"}}),t.jsxs("span",{style:{fontSize:"0.72rem",color:"var(--sl-color-gray-3)",fontFamily:"monospace"},children:[e.name,e.name===o.currentBranch?" (HEAD)":""]})]},e.name))})]})}export{ge as default};
