import{j as r}from"./jsx-runtime.ClP7wGfN.js";import{r as i}from"./index.DK-fsZOb.js";import{A as q}from"./index.CMzh-1wI.js";import{m as D}from"./proxy.i6brGrIQ.js";const B=[{key:"point-to-point",label:"Point-to-Point",description:"Each message is delivered to exactly one consumer. Messages are load-balanced across consumers."},{key:"pub-sub",label:"Pub/Sub",description:"Each message is delivered to ALL subscribers. Every consumer receives a copy of every message."},{key:"consumer-groups",label:"Consumer Groups",description:"Messages are partitioned across consumer groups. Each partition is consumed by one consumer in the group."}],L=["#0066cc","#8b5cf6","#ec4899","#f59e0b","#10b981","#ef4444"];function _(g=640){const[o,C]=i.useState(!1);return i.useEffect(()=>{const u=window.matchMedia(`(max-width: ${g}px)`);C(u.matches);const w=z=>C(z.matches);return u.addEventListener("change",w),()=>u.removeEventListener("change",w)},[g]),o}function re(){const g=_(),[o,C]=i.useState("point-to-point"),[u,w]=i.useState(50),[z,M]=i.useState([]),[y,W]=i.useState({produced:0,delivered:0,inQueue:0,throughput:0}),[A,G]=i.useState(!1),$=i.useRef(1),f=i.useRef(0),b=i.useRef(null),E=i.useRef(null),v=i.useRef([]),R=o==="consumer-groups"?4:3,H=o==="consumer-groups"?["G1-C1","G1-C2","G2-C1","G2-C2"]:o==="pub-sub"?["Sub A","Sub B","Sub C"]:["Consumer 1","Consumer 2","Consumer 3"],j=g?30:60,c=g?140:220,d=g?250:400,Y=g?300:480,k=g?200:220,a=e=>k/(R+1)*(e+1),S=k/2,p=k/2,I=i.useCallback(()=>{const e=$.current++,s=L[(e-1)%L.length];let n=null;o==="point-to-point"?(n=f.current%R,f.current++):o==="pub-sub"?n=Array.from({length:R},(l,h)=>h):(n=e%2===0?f.current%2===0?0:1:f.current%2===0?2:3,f.current++);const x={id:e,label:`M${e}`,color:s,phase:"producing",targetConsumer:n,x:j,y:S};M(l=>[...l,x]),W(l=>({...l,produced:l.produced+1}))},[o,R,j,S]);i.useEffect(()=>{const e=Math.max(30,120-u);return E.current=setInterval(()=>{M(s=>{let n=0;const x=s.map(m=>{const t={...m},Q=3+u*.05;if(t.phase==="producing")t.x<c-10?t.x+=Q:(t.phase="in-queue",t.x=c,t.y=p);else if(t.phase==="in-queue")t.phase="delivering";else if(t.phase==="delivering"){const F=(Array.isArray(t.targetConsumer)?t.targetConsumer:[t.targetConsumer??0])[0],N=a(F);t.x<d-10?(t.x+=Q,t.y+=(N-t.y)*.1):(t.phase="delivered",n++)}return t});if(n>0){v.current.push(Date.now());const m=Date.now();v.current=v.current.filter(t=>m-t<5e3),W(t=>({...t,delivered:t.delivered+n,throughput:v.current.length}))}const l=x.filter(m=>m.phase!=="delivered"),h=l.filter(m=>m.phase==="in-queue"||m.phase==="delivering").length;return W(m=>({...m,inQueue:h})),l})},e),()=>{E.current&&clearInterval(E.current)}},[u,c,p,d,o]),i.useEffect(()=>{if(!A){b.current&&clearInterval(b.current);return}const e=Math.max(300,2e3-u*18);return b.current=setInterval(I,e),()=>{b.current&&clearInterval(b.current)}},[A,u,I]);const T=i.useCallback(()=>{M([]),W({produced:0,delivered:0,inQueue:0,throughput:0}),G(!1),$.current=1,f.current=0,v.current=[]},[]),X=e=>{T(),C(e)},O=()=>{const e=[];for(const s of z)if(o==="pub-sub"&&Array.isArray(s.targetConsumer)&&s.phase==="delivering")for(const n of s.targetConsumer){const x=a(n),l=Math.min(1,(s.x-c)/(d-c)),h=p+(x-p)*l;e.push({...s,visualId:`${s.id}-${n}`,visualTarget:n,y:h})}else{const n=Array.isArray(s.targetConsumer)?s.targetConsumer[0]:s.targetConsumer??0;e.push({...s,visualId:`${s.id}`,visualTarget:n})}return e},V=e=>({borderRadius:6,padding:"0.5rem 0.9rem",minHeight:44,border:e?"2px solid #0066cc":"1px solid var(--sl-color-gray-5)",background:e?"#0066cc":"var(--sl-color-gray-6)",color:e?"#fff":"var(--sl-color-text)",cursor:"pointer",fontSize:"0.8rem",fontWeight:600,transition:"all 0.15s",whiteSpace:"nowrap"}),P=e=>({padding:"0.4rem 0.9rem",borderRadius:"6px",border:"none",background:e,color:"#fff",fontWeight:600,fontSize:"0.8rem",cursor:"pointer",minHeight:36});return r.jsxs("div",{style:{border:"1px solid var(--sl-color-gray-5)",borderRadius:"0.75rem",overflow:"hidden",margin:"1.5rem 0"},children:[r.jsxs("div",{style:{padding:"1rem 1.25rem",borderBottom:"1px solid var(--sl-color-gray-5)",background:"var(--sl-color-gray-6)"},children:[r.jsx("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:700},children:"Message Queue Visualizer"}),r.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:"var(--sl-color-gray-3)"},children:"Explore messaging patterns: Point-to-Point, Pub/Sub, and Consumer Groups"})]}),r.jsxs("div",{style:{padding:"1.25rem"},children:[r.jsx("div",{style:{display:"flex",gap:"0.4rem",marginBottom:"1rem",overflowX:"auto",paddingBottom:"0.2rem"},children:B.map(e=>r.jsx("button",{onClick:()=>X(e.key),style:V(o===e.key),children:e.label},e.key))}),r.jsx(q,{mode:"wait",children:r.jsx(D.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},style:{padding:"0.6rem 0.9rem",borderRadius:"6px",background:"#0066cc15",border:"1px solid #0066cc40",fontSize:"0.78rem",color:"var(--sl-color-gray-2)",marginBottom:"1rem",lineHeight:1.5},children:B.find(e=>e.key===o)?.description},o)}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"1rem",alignItems:"center"},children:[r.jsx("button",{style:P("#0066cc"),onClick:I,children:"Produce Message"}),r.jsx("button",{style:P(A?"#ef4444":"#10b981"),onClick:()=>G(e=>!e),children:A?"Stop Auto":"Auto Produce"}),r.jsx("button",{style:P("var(--sl-color-gray-4)"),onClick:T,children:"Reset"}),r.jsxs("label",{style:{fontSize:"0.75rem",display:"flex",alignItems:"center",gap:"0.35rem",color:"var(--sl-color-gray-3)",marginLeft:"auto"},children:["Speed",r.jsx("input",{type:"range",min:10,max:100,value:u,onChange:e=>w(Number(e.target.value)),style:{width:g?"4rem":"6rem",accentColor:"#0066cc"}})]})]}),r.jsx("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap",marginBottom:"1rem"},children:[{label:"Produced",value:y.produced,color:"#0066cc"},{label:"Delivered",value:y.delivered,color:"#10b981"},{label:"In Queue",value:y.inQueue,color:"#f59e0b"},{label:"Throughput",value:`${y.throughput}/5s`,color:"#8b5cf6"}].map(e=>r.jsxs("div",{style:{padding:"0.4rem 0.7rem",borderRadius:"6px",background:`${e.color}12`,border:`1px solid ${e.color}40`,fontSize:"0.75rem",display:"flex",alignItems:"center",gap:"0.4rem"},children:[r.jsxs("span",{style:{color:"var(--sl-color-gray-3)"},children:[e.label,":"]}),r.jsx("span",{style:{fontWeight:700,color:e.color,fontFamily:"monospace"},children:e.value})]},e.label))}),r.jsx("div",{style:{background:"var(--sl-color-gray-7, #0d1117)",borderRadius:"0.5rem",padding:"1rem",marginBottom:"1rem",position:"relative",overflow:"hidden"},children:r.jsxs("svg",{width:"100%",height:k,viewBox:`0 0 ${Y} ${k}`,style:{display:"block"},children:[r.jsx("rect",{x:j-30,y:S-25,width:60,height:50,rx:8,fill:"#0066cc20",stroke:"#0066cc",strokeWidth:1.5}),r.jsx("text",{x:j,y:S+2,textAnchor:"middle",fontSize:"10",fill:"#0066cc",fontWeight:600,children:"Producer"}),r.jsx("rect",{x:c-35,y:p-30,width:70,height:60,rx:8,fill:"#f59e0b18",stroke:"#f59e0b",strokeWidth:1.5}),r.jsx("text",{x:c,y:p-10,textAnchor:"middle",fontSize:"9",fill:"#f59e0b",fontWeight:700,children:o==="pub-sub"?"Topic":o==="consumer-groups"?"Partitions":"Queue"}),r.jsx("text",{x:c,y:p+6,textAnchor:"middle",fontSize:"14",fill:"#f59e0b",fontWeight:700,children:y.inQueue}),r.jsx("text",{x:c,y:p+20,textAnchor:"middle",fontSize:"8",fill:"var(--sl-color-gray-4)",children:"messages"}),H.map((e,s)=>{const n=a(s),x=o==="consumer-groups"&&s<2,l=o==="consumer-groups"&&s>=2,h=x?"#10b981":l?"#8b5cf6":"#10b981";return r.jsxs("g",{children:[r.jsx("line",{x1:c+35,y1:p,x2:d-30,y2:n,stroke:"var(--sl-color-gray-5)",strokeWidth:.5,strokeDasharray:"3 3"}),r.jsx("rect",{x:d-30,y:n-18,width:60,height:36,rx:6,fill:`${h}15`,stroke:h,strokeWidth:1.5}),r.jsx("text",{x:d,y:n+4,textAnchor:"middle",fontSize:"9",fill:h,fontWeight:600,children:e})]},s)}),o==="consumer-groups"&&r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:d-40,y:a(0)-28,width:80,height:a(1)-a(0)+56,rx:10,fill:"none",stroke:"#10b981",strokeWidth:1,strokeDasharray:"4 4"}),r.jsx("text",{x:d+45,y:a(0)+(a(1)-a(0))/2+4,fontSize:"8",fill:"#10b981",fontWeight:600,children:"Group 1"}),r.jsx("rect",{x:d-40,y:a(2)-28,width:80,height:a(3)-a(2)+56,rx:10,fill:"none",stroke:"#8b5cf6",strokeWidth:1,strokeDasharray:"4 4"}),r.jsx("text",{x:d+45,y:a(2)+(a(3)-a(2))/2+4,fontSize:"8",fill:"#8b5cf6",fontWeight:600,children:"Group 2"})]}),r.jsx("line",{x1:j+30,y1:S,x2:c-35,y2:p,stroke:"var(--sl-color-gray-5)",strokeWidth:.5,strokeDasharray:"3 3"}),r.jsx(q,{children:O().map(e=>r.jsxs(D.g,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},children:[r.jsx("circle",{cx:e.x,cy:e.y,r:7,fill:e.color,opacity:.9}),r.jsx("text",{x:e.x,y:e.y+3,textAnchor:"middle",fontSize:"6",fill:"#fff",fontWeight:700,children:e.label})]},e.visualId))})]})}),r.jsxs("div",{style:{padding:"0.75rem 0.9rem",borderRadius:"8px",background:"var(--sl-color-gray-6)",border:"1px solid var(--sl-color-gray-5)",fontSize:"0.78rem",lineHeight:1.6,color:"var(--sl-color-gray-2)"},children:[r.jsxs("div",{style:{fontWeight:700,marginBottom:"0.35rem",fontSize:"0.82rem"},children:["How ",B.find(e=>e.key===o)?.label," Works"]}),o==="point-to-point"&&r.jsxs("div",{children:["Messages are placed in a queue and delivered to exactly ",r.jsx("strong",{children:"one"})," consumer using round-robin or load-balancing. This is ideal for task distribution where each task should be processed once. Examples: job queues, order processing, task workers."]}),o==="pub-sub"&&r.jsxs("div",{children:["A producer publishes messages to a ",r.jsx("strong",{children:"topic"}),". All subscribers receive a copy of every message independently. This enables event-driven architectures where multiple systems react to the same events. Examples: notifications, event sourcing, real-time feeds."]}),o==="consumer-groups"&&r.jsxs("div",{children:["Messages are partitioned across ",r.jsx("strong",{children:"consumer groups"}),". Within each group, each partition is assigned to exactly one consumer. This combines the benefits of pub/sub (multiple groups) with point-to-point (load balancing within a group). Examples: Kafka consumer groups, competing consumers."]})]})]})]})}export{re as default};
